# Управление категориями продуктов

## Обзор

Теперь владелец магазина может самостоятельно управлять категориями продуктов через админ-панель.

## Что было создано

### 1. База данных
- **Таблица**: `categories` в Supabase
- **Поля**:
  - `id` (TEXT, PRIMARY KEY) - уникальный идентификатор категории
  - `name` (TEXT) - название категории
  - `slug` (TEXT) - URL-дружественный slug
  - `description` (TEXT) - описание категории
  - `image` (TEXT) - URL изображения категории
  - `created_at`, `updated_at` - временные метки

### 2. API эндпоинты
- `GET /api/admin/categories` - получить все категории
- `POST /api/admin/categories` - создать новую категорию
- `PUT /api/admin/categories/[id]` - обновить категорию
- `DELETE /api/admin/categories/[id]` - удалить категорию

### 3. Интерфейс админ-панели
- **Страница**: `/admin/categories`
- **Функции**:
  - Просмотр всех категорий
  - Добавление новой категории
  - Редактирование существующих категорий
  - Удаление категорий (с проверкой на наличие товаров)

### 4. Интеграция с продуктами
- Формы создания и редактирования продуктов теперь используют категории из базы данных
- Выпадающий список категорий обновляется автоматически

## Установка

### Шаг 1: Создание таблицы в Supabase

1. Откройте Supabase Dashboard: https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в SQL Editor
4. Выполните SQL скрипт из файла: `supabase/migrations/create_categories_table.sql`

### Шаг 2: Проверка RLS политик

Убедитесь, что RLS политики созданы правильно:
- Публичный доступ на чтение (SELECT)
- Service role может создавать, обновлять и удалять

### Шаг 3: Перезапуск приложения

```bash
npm run dev
```

## Использование

### Доступ к управлению категориями

1. Войдите в админ-панель: `/admin`
2. Нажмите на карточку "Kategorien verwalten"
3. Вы попадёте на страницу `/admin/categories`

### Создание новой категории

1. Нажмите кнопку "Neue Kategorie"
2. Заполните обязательные поля:
   - **Kategorie-ID**: уникальный идентификатор (например, `perfume`, `skincare`)
   - **Name**: отображаемое название (например, `Parfüm`, `Hautpflege`)
3. Опционально заполните:
   - **Slug**: URL-slug (если не указан, будет использован ID)
   - **Beschreibung**: описание категории
   - **Bild URL**: ссылка на изображение
4. Нажмите "Erstellen"

### Редактирование категории

1. На странице категорий найдите нужную категорию
2. Нажмите иконку карандаша (редактировать)
3. Измените нужные поля
4. Нажмите "Speichern"

### Удаление категории

1. Нажмите иконку корзины рядом с категорией
2. Подтвердите удаление
3. **Важно**: нельзя удалить категорию, если в ней есть товары

## Примечания

### Fallback на дефолтные категории

Если база данных недоступна или в ней нет категорий, система автоматически использует дефолтные категории из `lib/hooks/useCategories.ts`.

### Дефолтные категории

При первом выполнении SQL скрипта будут созданы 6 категорий:
- Haarpflege (hair-care)
- Gesichtspflege (face-care)
- Körperpflege (body-care)
- Make-up (makeup)
- Nagelpflege (nails)
- Werkzeuge (tools)

### Изображения категорий

Используйте ссылки на изображения из внешних источников (например, Unsplash, Cloudinary).

Пример хорошего URL:
```
https://images.unsplash.com/photo-1234567890?w=600&h=400&fit=crop
```

## Техническая информация

### Структура файлов

```
beauty-salon-shop/
├── app/
│   ├── admin/
│   │   ├── categories/
│   │   │   └── page.tsx              # Страница управления категориями
│   │   └── page.tsx                  # Обновлена: добавлена карточка категорий
│   └── api/
│       └── admin/
│           └── categories/
│               ├── route.ts          # GET, POST эндпоинты
│               └── [id]/
│                   └── route.ts      # PUT, DELETE эндпоинты
├── lib/
│   ├── data/
│   │   └── categories.ts             # Функции для работы с категориями (SSR)
│   └── hooks/
│       └── useCategories.ts          # React hook для клиентских компонентов
└── supabase/
    └── migrations/
        └── create_categories_table.sql  # SQL скрипт создания таблицы
```

### Миграция существующих продуктов

Все существующие продукты уже используют правильные ID категорий из дефолтного набора, поэтому дополнительная миграция не требуется.

## Возможные проблемы и решения

### Проблема: Категории не загружаются

**Решение**: 
1. Проверьте, выполнен ли SQL скрипт в Supabase
2. Проверьте RLS политики в Supabase Dashboard
3. Проверьте консоль браузера на наличие ошибок API

### Проблема: Не могу удалить категорию

**Причина**: В категории есть товары

**Решение**: 
1. Переместите все товары в другую категорию
2. Или удалите товары из этой категории
3. Затем попробуйте удалить категорию снова

### Проблема: Дублирующиеся ID категорий

**Решение**: ID категории должен быть уникальным. Используйте другой ID.

## Безопасность

- Все операции создания/обновления/удаления требуют `service_role` доступа
- Публичный доступ разрешён только на чтение
- Клиентские компоненты используют server-side API для безопасного доступа к данным

## Дальнейшее развитие

Возможные улучшения:
- Загрузка изображений напрямую в Supabase Storage
- Drag-and-drop сортировка категорий
- Подкатегории (вложенные категории)
- Счётчик товаров в каждой категории
- Массовое перемещение товаров между категориями
