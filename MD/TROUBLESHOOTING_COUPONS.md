–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

## Stripe - –∫—É–ø–æ–Ω –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞**: Webhook –ø–æ–ª—É—á–∞–µ—Ç metadata, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ coupon_usages
**–†–µ—à–µ–Ω–∏–µ**: 
1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `/api/checkout` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç discount –∏ couponCode
2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ webhook - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç metadata
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `couponCode !== ''`

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: 
- –°–¥–µ–ª–∞–π —Ç–µ—Å—Ç–æ–≤—É—é –æ–ø–ª–∞—Ç—É —Å–æ —Å–∫–∏–¥–∫–æ–π
- –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞ —Å—Ç—Ä–æ–∫–∏:
  ```
  üí∞ Discount info: { discount: 10, couponCode: 'WELCOME10', discountAmount: 10 }
  üîç Checking coupon metadata: ...
  üéüÔ∏è Recording coupon usage: WELCOME10
  ```

## PayPal - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. CSP –µ—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è (–Ω—É–∂–µ–Ω hard refresh: Ctrl+Shift+R)
2. PayPal SDK –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
3. –û—à–∏–±–∫–∞ –≤ console –±—Ä–∞—É–∑–µ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
1. –û—Ç–∫—Ä–æ–π DevTools (F12) ‚Üí Console
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å Ctrl+Shift+R
3. –ü–æ–ø—Ä–æ–±—É–π –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ PayPal
4. –°–∫–æ–ø–∏—Ä—É–π –õ–Æ–ë–´–ï –æ—à–∏–±–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏

**–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ CSP**:
–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫–∏ –ø—Ä–æ "Content Security Policy", –∑–Ω–∞—á–∏—Ç –±—Ä–∞—É–∑–µ—Ä –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–ª —Å—Ç–∞—Ä—ã–µ headers.
- Chrome: Ctrl+Shift+Delete ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
- –ò–ª–∏ –æ—Ç–∫—Ä–æ–π –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ

## –¢—Ä–∏–≥–≥–µ—Ä uses_count

**–°—Ç–∞—Ç—É—Å**: –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω –≤ `20250130_fix_coupon_counter.sql`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**:
–ó–∞–ø—É—Å—Ç–∏ –≤ Supabase SQL Editor:
```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
SELECT 
    c.code,
    c.uses_count,
    COUNT(cu.id) as actual_usages
FROM coupons c
LEFT JOIN coupon_usages cu ON cu.coupon_id = c.id
GROUP BY c.id;
```

–ï—Å–ª–∏ uses_count != actual_usages, –∑–Ω–∞—á–∏—Ç —Ç—Ä–∏–≥–≥–µ—Ä –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª.
