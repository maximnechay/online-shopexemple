# üìß Email System Documentation

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç [Resend](https://resend.com/) –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º.

## ‚úÖ –ß—Ç–æ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

1. **Email —Å–µ—Ä–≤–∏—Å** (`lib/email/send.ts`)
   - –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º
   - –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω—É
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Resend API

2. **Email —à–∞–±–ª–æ–Ω—ã** (`lib/email/templates/`)
   - `orderConfirmation.ts` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
   - `statusUpdate.ts` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
   - `adminNotification.ts` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - ‚úÖ Stripe webhook (`app/api/webhooks/stripe/route.ts`)
   - ‚úÖ PayPal capture (`app/api/paypal/capture-order/route.ts`)

4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (`.env.local`)
   ```env
   RESEND_API_KEY=re_fniz4Sah_LFc4tR4eR3JWoBFtyjBNTueY
   EMAIL_FROM=Beauty Salon <noreply@xinvestai.com>
   ADMIN_EMAIL=nechay1996@gmail.com
   ```

## üì® –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 2 –ø–∏—Å—å–º–∞:

1. **–ö–ª–∏–µ–Ω—Ç—É** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
2. **–ê–¥–º–∏–Ω—É** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç–ø—Ä–∞–≤–∫–∏

**Stripe:**
- Webhook —Å–æ–±—ã—Ç–∏–µ `checkout.session.completed`
- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `processing`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è email

**PayPal:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ capture –ø–ª–∞—Ç–µ–∂–∞
- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `processing`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è email

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm run dev`
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑
4. –û–ø–ª–∞—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π Stripe/PayPal
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∞–¥–º–∏–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: API —Ç–µ—Å—Ç

–°–æ–∑–¥–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
POST http://localhost:3000/api/test-email
Content-Type: application/json

{
  "orderId": "–≤–∞—à-order-id-–∏–∑-–±–∞–∑—ã"
}
```

**–ü—Ä–∏–º–µ—Ä —Å curl:**
```bash
curl -X POST http://localhost:3000/api/test-email \
  -H "Content-Type: application/json" \
  -d '{"orderId": "123e4567-e89b-12d3-a456-426614174000"}'
```

**–ü—Ä–∏–º–µ—Ä —Å Postman/Thunder Client:**
1. –°–æ–∑–¥–∞–π—Ç–µ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `http://localhost:3000/api/test-email`
2. –í Body –≤—ã–±–µ—Ä–∏—Ç–µ JSON
3. –í—Å—Ç–∞–≤—å—Ç–µ: `{"orderId": "—Ä–µ–∞–ª—å–Ω—ã–π-id-–∑–∞–∫–∞–∑–∞"}`
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑ –∫–æ–¥–∞

```typescript
import { sendOrderEmails } from '@/lib/email/helpers';

// –í –ª—é–±–æ–º —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Ñ–∞–π–ª–µ
await sendOrderEmails('order-id-–∑–¥–µ—Å—å');
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ email –ø–∏—Å–µ–º

### –ü–∏—Å—å–º–æ –∫–ª–∏–µ–Ω—Ç—É —Å–æ–¥–µ—Ä–∂–∏—Ç:

- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- üì¶ –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
- üí∞ –ò—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É (—Ç–æ–≤–∞—Ä—ã + –¥–æ—Å—Ç–∞–≤–∫–∞ + –Ω–∞–ª–æ–≥)
- üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- üîó –°—Å—ã–ª–∫—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- üìß –ö–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### –ü–∏—Å—å–º–æ –∞–¥–º–∏–Ω—É —Å–æ–¥–µ—Ä–∂–∏—Ç:

- üÜï –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ
- üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∏–µ–Ω—Ç–µ
- üì¶ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- üìç –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- üîó –°—Å—ã–ª–∫—É –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –≤ Resend

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [resend.com](https://resend.com/domains)
2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `beautysalon.de`)
3. –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
5. –û–±–Ω–æ–≤–∏—Ç–µ `.env.local`:
   ```env
   EMAIL_FROM=Beauty Salon <noreply@beautysalon.de>
   ```

### –¢–µ–∫—É—â–∏–π –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: `Beauty Salon <noreply@xinvestai.com>`
- –≠—Ç–æ —Ä–∞–±–æ—á–∏–π –¥–æ–º–µ–Ω, –ø–∏—Å—å–º–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è
- –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –¥–æ–º–µ–Ω

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

Email –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

```
üìß Order emails sent successfully
‚úÖ Customer email result: ...
‚úÖ Admin email result: ...
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏:
```
‚ùå Error sending order emails: ...
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ü–∏—Å—å–º–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `RESEND_API_KEY` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –≤ Resend

2. **–û—à–∏–±–∫–∞ "Order data not found"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–∫–∞–∑ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –∑–∞–∫–∞–∑–∞ –µ—Å—Ç—å `order_items`

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–∏—Å—å–º–µ**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `getOrderEmailData` –≤ `lib/email/helpers.ts`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Resend Dashboard

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤ [Resend Dashboard](https://resend.com/emails):
- –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç–∏–π
- –ö–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º
- –û—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### Supabase Logs

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ Edge Functions –≤ Supabase –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã —Å email
SELECT 
    id, 
    order_number,
    customer_email,
    payment_status,
    status,
    created_at
FROM orders
ORDER BY created_at DESC
LIMIT 10;
```

## üöÄ Production Checklist

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production:

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –¥–æ–º–µ–Ω –≤ Resend
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `EMAIL_FROM` –Ω–∞ —Å–≤–æ–π –¥–æ–º–µ–Ω
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `ADMIN_EMAIL` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π email –∞–¥–º–∏–Ω–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö email —Å–µ—Ä–≤–∏—Å–∞—Ö (Gmail, Outlook, etc)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∏—Å–µ–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DMARC/SPF/DKIM –¥–ª—è –¥–æ–º–µ–Ω–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –æ—Ç–ø–∏—Å–∫–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã Resend –ø–ª–∞–Ω–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Resend –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é](https://resend.com/docs)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Resend Dashboard
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –¥–æ–º–µ–Ω–∞

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** November 2024
